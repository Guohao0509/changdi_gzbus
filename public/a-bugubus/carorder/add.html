<div class="wrapper-md" ng-controller="addCarOrderController">
    <div class="panel panel-default" ng-show="!showTicket">
        <div class="panel-heading">
            添加线下票据
        </div>
        <div class="panel-body">
            <form class="form-horizontal form-validation" name="form">
                <!-- <div class="form-group">
                    <label class="col-sm-2 control-label">用户ID<span class="text-danger text-md ">*</span></label>
                    <div class="col-sm-10">
                        <input type="text"  class="form-control"
                               name="userid"
                               ng-model="carorder.userid"
                               ng-required="true"
                               disabled>
                    </div>
                </div> -->
                <div class="line line-dashed b-b line-lg pull-in"  ng-if="session_user.access == 'systemUser'"></div>
                <div class="form-group" ng-if="session_user.access == 'systemUser'">
                    <label class="col-sm-1 control-label">线下门店<span class="text-danger text-md ">*</span></label>
                    <div class="col-sm-11" ng-click="loadTicketSource()">
                        <input class="form-control" type="text" ng-model="ticketSourceName" ng-if="!carorder.havePower" disabled>
                        <select class="form-control" ng-init="carorder.offline = '0'" ng-model="carorder.offline" ng-required="true" ng-change="showSourceid()" ng-if="carorder.havePower">
                            <option value="0" style="display: none;">请选择</option>
                            <option ng-repeat="item in ticketSourceList.sources" value="{{item.ticketSource}}">{{item.ticketSource}}</option>
                        </select>
                        <!-- <select  class="input-sm form-control"  name="viewOrderStatus" ng-model="carorder.offline">
                            <option  ng-repeat="item in ticketSourceList.sources" value="{{item.ticketSource}}"  placeholder="选择门店" selected = "selected">
                               {{item.ticketSource}}
                            </option>
                        </select> -->
                    </div>
                </div>
                <!-- <div class="form-group">
                    <label class="col-sm-2 control-label">票据数量<span class="text-danger text-md ">*</span></label></label>
                    <div class="col-sm-10">
                        <input type="number"  class="form-control"
                               name="ticketNum"
                               ng-model="carorder.ticketNum"
                               ng-required="true"
                               >
                    </div>
                </div> -->
                <div class="form-group" ng-if="carorder.needSourceId">
                    <label class="col-sm-1 control-label">来源票ID<span class="text-danger text-md ">*</span></label></label>
                    <div class="col-sm-11">
                        <input type="text"  class="form-control"
                               name="ticketNum"
                               ng-pattern="/^[0-9]{1,30}$/"
                               ng-model="carorder.sourceid"
                               ng-required = "true"
                               >
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-1  text-right">
                        <label class="control-label">出发日期<span class="text-danger text-md ">*</span></label>
                    </div>
                    <div class="col-sm-5">
                        <input type="text" placeholder="注册时间如2017-01-01" class="form-control" ng-click="scheduleTime.open($event)" datepicker-popup="{{scheduleTime.format}}" name="regDate" ng-model="departDate" is-open="scheduleTime.opened" datepicker-options="scheduleTime.dateOptions" close-text="关闭" clear-text="清空"  current-text="今天" />
                    </div>
                </div>
            </form>
            <div class="line line-dashed b-b line-lg pull-in"></div>
            <div class="panel b-a">
                <div class="panel-heading b-b b-light">
                    添加排班
                    <span class="text-danger text-md ">*</span>
                </div>
                <!-- <div class="wrapper b-light text-center">
                    <a href class="btn btn-danger btn-addon" ng-click="selectScheduleToggle()"><i class="fa fa-plus"></i>
                        添加排班
                    </a>
                </div> -->
                <div class="bg-light">
                    
                    <div class="table-responsive" ng-if="departDate">
                        <table  cellpadding="0" cellspacing="0" border="0" class=" dataTable table table-striped b-t b-light table-condensed">
                            <thead>
                            <tr>
                                <th>选择班次</th>
                                <!-- <th>产品ID</th> -->
                                <th>班次名称</th>
                                <th>班次类型</th>
                                <th>起点</th>
                                <th>终点</th>
                                <th>发车地址</th>
                                <th>出发时间</th>
                                <th>车票价格(元)</th>
                                <th>门票价格</th>
                                <th>时长</th>
                                <th>余票/总票数</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="item in dateSchedules">
                                <td>
                                    <label class="i-checks m-b-none">
                                        <input type="radio" ng-disabled="item.leftTickets==0" name="selectSchedule" ng-click=selectSchedule(item,$index)><i></i>
                                    </label>
                                </td>
                                <td ng-bind="item.gobsname"></td>
                                <td>
                                    <span ng-if="item.productType == 0">单程
                                        <span ng-if="item.haveTicket == 1">&nbsp;+&nbsp;</span>
                                        <span ng-if="item.haveTicket == 1" class="label label-warning">门票</span>
                                    </span>
                                    <span ng-if="item.productType == 1">往返
                                        <span ng-if="item.haveTicket == 1">&nbsp;+&nbsp;</span>
                                        <span ng-if="item.haveTicket == 1" class="label label-warning">门票</span>
                                    </span>
                                </td>
                                <td ng-bind="item.departName"></td>
                                <td ng-bind="item.arriveName"></td>
                                <td ng-bind="item.departaddr"></td>
                                <td ng-bind="item.departtime"></td>
                                <th ng-bind="item.goPrice"></th>
                                <th>
                                    <select id="select{{$index}}" ng-disabled="disabledSelect != $index" class="form-control" style="padding: 2px;height: auto;" ng-if="item.haveTicket == 1">
                                        <option value="0" style="display: none;">请选择</option>
                                        <option ng-repeat="price in item.viewPrices" value="{{price.viewPriceId}}" >
                                            {{price.viewPriceType}}:&nbsp;&nbsp;{{price.viewPrice}}元;&nbsp;&nbsp;折扣:&nbsp;&nbsp; {{price.viewCoupon*10}}折
                                        </option>
                                    </select>
                                </th>
                                <th>{{item.drivetime}} 分</th>
                                <td>
                                   剩 {{item.leftTickets}} 张 / {{item.totalTickets}} 张
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2" style="float: right;margin-right: 15px;">
                    <button type="reset" ng-show="!editMode" ng-click="reset()" class="btn btn-default">清空</button>
                    <button type="submit" ng-click="submit()" ng-disabled="submiting||missParm||!carorder.schedule||overDeadLineTime" class="btn btn-primary m-l">提交</button>
                </div>
            </div>
        </div>
    </div>
    <div class="row" ng-if="showTicket">
        <div class="col-sm-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    导出车票<span>共计:&nbsp;&nbsp;{{ticket.payPrice}}&nbsp;元</span>
                </div>
                <div class="panel-body">
                    <div ticket ticket-info="ticket"></div>
                </div>
            </div>
        </div>
    </div>
</div>